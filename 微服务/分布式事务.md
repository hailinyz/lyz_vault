在分布式系统中，如果一个业务需要多个服务合作完成，而且每一个服务都有事务，多个事务必须同时成功或失败，这样的事务就是**分布式事务**。其中的每个服务的事务就是一个**分支事务**。整个业务称为**全局事务**。

![](assets/分布式事务/file-20251128134340365.png)

应该是都成功或者都失败才对

分布式事务解决思路：Seata架构

相互之间不知道对方成没成功，想办法让事务分支之间感知到彼此的事务状态，才能保证状态一致。

## Seata架构

+ TC - 事务协调者
+ TM - 事务管理器
+ RM - 资源管理器
![](assets/分布式事务/file-20251128135609206.png)

## Dcoker部署Seata

1. 注意：部署之前先看有哪些网桥
```powershell
docker network ls
```

2. 然后看自己的mysql容器是不是在这个网桥下：
```powershell
docker inspect mysql
```
我这里查出来的是在hmall下
![](assets/分布式事务/file-20251128141918491.png)

3. 再查以下nacos容器，我这里查出来是不在hmall里的
![](assets/分布式事务/file-20251128142249041.png)
如果不在就可以把已经存在的加进来：
```powershell
docker network connect hmall nacos
```

最后执行ru

```powershell
docker run --name seata \
-p 8099:8099 \
-p 7099:7099 \
-e SEATA_IP=192.168.100.0 \  # 改成你的虚拟机IP
-v ./seata:/seata-server/resources \
--privileged=true \
--network bridge \  # 改成你Nacos所在的默认网桥（原命令是hm-net，你没有这个自定义网络）
-d \
seataio/seata-server:1.5.2
```

